{% extends 'base.html' %}
{% block title %}Runner Dashboard{% endblock %}
{% block head %}
  <link rel="stylesheet" type="text/css" href="/static/dashboard.css">
{% endblock %}

{% block content %}

<nav class="navbar navbar-default navbar-dashboard">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button"
              class="navbar-toggle collapsed"
              data-toggle="collapse"
              data-target="#navbar"
              aria-expanded="false"
              aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
      </button>

      <a class="navbar-brand" href="#">Run Holmes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
          <li><a href="#">About Us</a></li>
          <li><a href="#">Contact</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
          <li><a href="/logout-complete">Log Out</a></li>
      </ul>
    </div>
  </div>
</nav>  


<div id="runner-id" name="{{ plan.runner_id }}" hidden></div>

{% if plan %}

<div class="container-fluid dashboard-body">

  <div class="row-fluid">
    <div class="col-xs-offset-2 col-xs-4"> 
      <!-- <h1 id="dashboard-header">Running Dashboard</h1> -->
      <h1 id="plan-name-title" class="dashboard-header">{{ plan.name }}<span><button id="update-plan-name" type="button" class="btn btn-default btn-xs">
        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
      </button></span></h1>
      <!-- <button id="update-plan-name">Update Plan Name</button> -->
      
      <form id="plan-name-change-box" action="/update-plan-name.json" method="POST">
        <input id="new-plan-name" placeholder="update plan name here" value="">
        <input id="plan-id" name="{{ plan.plan_id }}" hidden>
        <input type="submit" name="save" value="save"><br><br>
      </form>
    </div>

    <div class="col-xs-offset-2 col-xs-4">

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary" id="account-settings" data-toggle="modal" data-target="#exampleModalLong">
          Accountability Settings
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h2 class="modal-title" id="exampleModalLongTitle">Accountability Settings</h2>
                <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close"> -->
                  <!-- <span aria-hidden="true">&times;</span> -->
      <!--           </button> -->
              </div>
              <div class="modal-body">
                <form action="/update-account" id="update-account" method="POST">
                  <div>
                    <h3>Daily Text Reminders</h3>
                      {% if runner.is_subscribed_to_texts %}
                        <input type="checkbox" class="opt-text" name="opt-text" checked="checked">
                        <label>Update Phone:</label>
                        <input type="text" class="phone" name="phone-number" placeholder="{{ runner.phone[2:] }}">
                      {% else %}
                        <input type="checkbox" class="opt-text" name="opt-text">
                        <label>&nbsp I would like to receive text reminders on days that I have a run.</label>
                        <input type="text" class="phone" name="phone-number" placeholder="phone number here">
                      {% endif %}
                  </div>
                  <hr>
                  <div>
                    <h3>Weekly Email Reminders</h3>
                      {% if runner.is_subscribed_to_email %}
                        <input type="checkbox" class="opt-email" name="opt-email" checked="checked">
                      {% else %}
                        <input type="checkbox" class="opt-email" name="opt-email">
                      {% endif %}
                      <label>&nbsp I would like to receive weekly email reminders.</label>
                  </div>
                  <hr>
                  <div>
                    <h3>Google Calendar</h3>
                    {% if runner.is_using_gCal %}
                      <input type="checkbox" class="opt-gcal" name="opt-gcal" checked="checked">
                    {% else %}
                      <input type="checkbox" class="opt-gcal" name="opt-gcal">
                    {% endif %}
                    <label>&nbsp I would like to add my runs to my Google Calendar.</label><br>
                    <p id="options-below">Don't forget to update your timezone and start time below before clicking save!</p>
                    <label>Timezone</label>
                    <select id="time-zone" name="time-zone">
                      <!-- <option disabled value="None">Select your preferred timezone</option> -->
                      <option selected value="{{ runner.timezone }}">{{ runner.timezone }}</option>
                      <option value="Pacific/Honolulu">(GMT-10:00) Hawaii Time</option>
                      <option value="America/Anchorage">(GMT-08:00) Alaska Time</option>
                      <option value="America/Los_Angeles">(GMT-07:00) Pacific Time</option>
                      <option value="America/Denver">(GMT-06:00) Mountain Time</option>
                      <option value="America/Phoenix">(GMT-07:00) Mountain Time - Arizona</option>
                      <option value="America/Chicago">(GMT-05:00) Central Time</option>
                      <option value="America/New_York">(GMT-04:00) Eastern Time</option>
                    </select><br>
                    <label>Start Time</label>
                    <select id="cal-run-start-time" name="cal-run-start-time">
                      <option selected value="{{ plan.start_time.time() }}">{{ plan.start_time.time() }}</option>
                     <!--  <option disabled value="Select your preferred start time">Select your preferred start time</option> -->
                      {% for time in times[0:10] %}
                        <option value="0{{ time }}:00:00">{{ time }}:00am</option>
                      {% endfor %}
                      {% for time in times[10:11] %}
                        <option value="{{ time }}:00:00">{{ time }}:00am</option>
                      {% endfor %}
                      <option value="{{ times[11] }}:00:00">{{ times[11] }}:00pm</option>
                      {% for time in times[12:23] %}
                        <option value="{{ time }}:00:00">{{ time - 12 }}:00pm</option>
                      {% endfor %}
                      <option value="{{ times[23] }}:00:00">{{ times[23] - 12 }}:00am</option>
                    </select>
                  </div>
                </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <input type="submit" class="btn btn-primary" value="Save changes">
              </div>
              </form>
            </div>
          </div>
        </div>
      </div> <!-- maybe delete? -->
    </div>
  </div>

  <div class="row charts-display">

    <div class="col-xs-offset-2 col-xs-2 runner-updates">
      <p class="chart-titles">Countdown to Goal</p>
      <p class="training-info">{{ days_left_to_goal }}<span class="smaller-training-info">days</span></p>
    </div>

    <div class="col-xs-2 runner-updates">
      <p class="chart-titles">Today's Workout</p>
      <p class="training-info">3<span class="smaller-training-info"> miles</span></p>
    </div>

    <div class="col-xs-2 runner-updates">
      <p class="chart-titles">{{ total_workouts_completed }} Workouts Completed</p>
      <div class="workouts-chart">
        <canvas id="donutChartWorkouts" class="doughnut-chart"></canvas>
        <div id="donutLegend" class="chart-legend"></div>
      </div>
    </div>

    <div class="col-xs-2 runner-updates">
      <p class="chart-titles">{{ total_miles_completed }} Miles Completed</p>
      <div class="workouts-chart">
        <canvas id="donutChartMileage" class="doughnut-chart"></canvas>
        <div id="donutLegend" class="chart-legend"></div>
      </div>
    </div>

  </div>

<!-- <span>Total Workouts Completed: </span><span id="total-workouts">{{ total_workouts_completed }}</span><br>
<span>Total Miles Completed: </span> <span id="total-miles"> {{ total_miles_completed }}</span><br>
 -->

 <div class="container-fluid patterned">
    <div class="row">
      <div class="col-xs-offset-1 col-xs-10 table-responsive">           
        <div id="run-completed-message"></div>

        <table id="plan-calendar" name="plan-calendar" border="1px" class="table table-bordered table-condensed">
          <thead id="plan-header">
            <tr>
              <th>Week</th>
              <th>Monday</th>
              <th>Tuesday</th>
              <th>Wednesday</th>
              <th>Thursday</th>
              <th>Friday</th>
              <th>Saturday</th>
              <th>Sunday</th>
            </tr>
          </thead>
          <tbody id="run-info-chart">
                {% for i in range(weeks_in_plan) %}
                  <tr>
                    <td class="week-number">Week {{ i + 1 }}</td>
                    {% for date in dates[(i)*7:7*(i+1)] %}
                      {% if date in runs %}
                        {% if runs[date]['is_completed'] == True %}
                          <td class="run completed-run" id="{{ runs[date]['run_id'] }}" name="{{ date }}">  {{ date.month }}/{{ date.day }}: <br><br><span class="miles">{{ runs[date]['distance'] }} miles</span></td>
                        {% elif runs[date]['is_completed'] == False and date < today_date %}
                          <td class="run incompleted-run old" id="{{ runs[date]['run_id'] }}" name="{{ date }}">  {{ date.month }}/{{ date.day }}: <br><br><span class="miles">{{ runs[date]['distance'] }} miles</span></td>
                        {% else %}
                          <td class="run incompleted-run" id="{{ runs[date]['run_id'] }}" name="{{ date }}">  {{ date.month }}/{{ date.day }}: <br><br><span class="miles">{{ runs[date]['distance'] }} miles</span></td>
                        {% endif %}  
                      {% else %}    
                        <td id="{{ date }}" class="off-day" name="{{ date }}">{{ date.month }}/{{ date.day }} <br><br>Off day!</td>
                      {% endif %}
                    {% endfor %}
                  </tr>
                {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>    
{% endif %}

{% endblock %}

{% block javascript %}
  <script src="static/dashboard_charts.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.1.62/jquery.inputmask.bundle.js"></script>
{% endblock %}